<robot>
  <!-- This file is a placeholder which is included by default from
       husky.urdf.xacro. If a robot is being customized and requires
       additional URDF, set the HUSKY_URDF_EXTRAS environment variable
       to the full path of the file you would like included. -->

    <link name="os_sensor_link">
        <visual>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
            <geometry>
                <mesh filename="file:///home/marco/4d_thesis/src/scout_2/meshes/os1_64.stl" scale="1.5 1.5 1.5"/>
            </geometry>
            <material name="Gray">
                <color rgba="0.5 0.5 0.5 1" />
            </material>
        </visual>
        
    </link>

    <joint name="os_sensor" type="fixed">
        <parent link="chassis_link"/>
        <child link="os_sensor_link"/>
        <origin rpy="0 0 0" xyz="0.1 0.0 0.714"/>
    </joint>

    <gazebo reference="os_sensor_link">

        <sensor name="laser" type="ray">
            <pose> 0 0 0 0 0 0 </pose>
            <visualize>true</visualize>
            <update_rate>10</update_rate>
            <ray>
                <scan>
                    <horizontal>
                        <samples>360</samples>
                        <min_angle>-3.14</min_angle>
                        <max_angle>3.14</max_angle>
                    </horizontal>
                </scan>
                <range>
                    <min>0.1</min>
                    <max>12</max>
                </range>
            </ray>
            <plugin name="laser_controller" filename="libgazebo_ros_ray_sensor.so">
                <ros>
                    <argument>~/out:=scan</argument>
                </ros>
                <output_type>sensor_msgs/LaserScan</output_type>
                <frame_name>os_sensor_link</frame_name>
            </plugin>
        </sensor>
    </gazebo>

    <link name="imu_sensor_link">
          <visual>
              <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
              <geometry>
                  <mesh filename="file:///home/marco/4d_thesis/src/scout_2/meshes/laser_link.stl" scale="1.5 1.5 1.5"/>
              </geometry>
              <material name="Gray">
                  <color rgba="0.5 0.5 0.5 1" />
              </material>
          </visual>
    </link>

    <joint name="imu_sensor" type="fixed">
        <parent link="chassis_link"/>
        <child link="imu_sensor_link"/>
        <origin rpy="0 0 0" xyz="0.0 0.0 0.50"/>
    </joint>

    <gazebo reference="imu_sensor_link">
      <sensor name="imu" type="imu">
        <always_on>true</always_on>
        <update_rate>100</update_rate>
        <visualize>true</visualize>
        <imu>
          <angular_velocity>
              <x>
              <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>2e-4</stddev>
                  <bias_mean>0.0000075</bias_mean>
                  <bias_stddev>0.0000008</bias_stddev>
                </noise>
              </x>
              <y>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>2e-4</stddev>
                  <bias_mean>0.0000075</bias_mean>
                  <bias_stddev>0.0000008</bias_stddev>
                </noise>
              </y>
              <z>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>2e-4</stddev>
                  <bias_mean>0.0000075</bias_mean>
                  <bias_stddev>0.0000008</bias_stddev>
                </noise>
              </z>
            </angular_velocity>
            <linear_acceleration>
              <x>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>1.7e-2</stddev>
                  <bias_mean>0.1</bias_mean>
                  <bias_stddev>0.001</bias_stddev>
                </noise>
              </x>
              <y>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>1.7e-2</stddev>
                  <bias_mean>0.1</bias_mean>
                  <bias_stddev>0.001</bias_stddev>
                </noise>
              </y>
              <z>
                <noise type="gaussian">
                  <mean>0.0</mean>
                  <stddev>1.7e-2</stddev>
                  <bias_mean>0.1</bias_mean>
                  <bias_stddev>0.001</bias_stddev>
                </noise>
              </z>
            </linear_acceleration>
          </imu>
        <plugin name="imu_controller" filename="libgazebo_ros_imu_sensor.so">
          <ros>
            <argument>~/out:=imu</argument>.
          </ros>
          <initial_orientation_as_reference>false</initial_orientation_as_reference>
        </plugin>
      </sensor>
    </gazebo>


    <link name="gps_link"></link>

    <joint name="gps_sensor" type="fixed">
        <parent link="chassis_link"/>
        <child link="gps_link"/>
        <origin rpy="0 0 0" xyz="0.0 0.0 0.40"/>
    </joint>

    <gazebo reference="gps_link">
      <sensor name="scout_gps" type="gps">
        <always_on>true</always_on>
        <update_rate>10</update_rate>
        <pose>0 0 0 0 0 0</pose>
        <gps>
          <position_sensing>
            <horizontal>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </horizontal>
            <vertical>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.01</stddev>
              </noise>
            </vertical>
          </position_sensing>
        </gps>
        <plugin name="my_gps_plugin" filename="libgazebo_ros_gps_sensor.so">
          <ros>
            <remapping>~/out:=/gps/fix</remapping>
          </ros>
        </plugin>
      </sensor>
    </gazebo>

    <!-- <link name="os_sensor_link">
      <inertial>
        <mass value="0.425"/>
        <origin xyz="0 0 0.03675" rpy="0 0 0" />
        <inertia ixx="0.000308429" ixy="0" ixz="0" iyy="0.000308429" iyz="0" izz="0.00034589"/>
      </inertial>
      <collision name="lidar_collision">
        <origin xyz="0 0 0.03675" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.04350" length="0.07350"/>
        </geometry>
      </collision>
      <visual name="lidar_visual">
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="file:///home/marco/gazebo_ws/src/scout_2/meshes/os1_64.stl" />
        </geometry>
      </visual>
    </link>

    <joint name="os_sensor" type="fixed">
        <parent link="base_link"/>
        <child link="os_sensor_link"/>
        <origin rpy="0 0 0" xyz="0.1 0.0 0.714"/>
    </joint>
    
    <gazebo reference="os_sensor_link">
      <sensor type="ray" name="lidar">
        <pose>0 0 0 0 0 0</pose>
        <visualize>true</visualize>
        <update_rate>10</update_rate>
        <ray>
          <scan>
            <vertical>
              <samples>64</samples>
              <resolution>1</resolution>
              <min_angle>0.14</min_angle>
              <max_angle>-0.14</max_angle>
            </vertical>
            <horizontal>
              <samples>360</samples>
              <resolution>1</resolution>
              <min_angle>-3.1415926535897931</min_angle>
              <max_angle>3.1415926535897931</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.3</min>
            <max>12</max>
            <resolution>0.03</resolution>
          </range>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.000000000001</stddev>
          </noise>
        </ray>
        <plugin name="gazebo_ros_laser_controller" filename="libgazebo_ros_ray_sensor.so">
            <ros>
                <remapping>~/out:=points</remapping>
            </ros>
            <frame_name>os_sensor_link</frame_name>
            <output_type>sensor_msgs/msg/PointCloud2</output_type>
        </plugin>
      </sensor>
    </gazebo> -->
</robot>
